from flask import Flask, render_template, request, jsonify
import random
import threading
import time

app = Flask(__name__)

class PremiumTikTokNameGenerator:
    def __init__(self):
        # Nadir isim bileşenleri
        self.short_prefixes = ["Kral", "Yıldız", "Gece", "Gün", "Ay", "Su", "Ateş", "Toprak", "Hava", "Buz", "Elmas", "Altın", "Gümüş", "Yıldırım", "Şimşek"]
        self.short_suffixes = ["TR", "06", "34", "07", "35", "01", "X", "Z", "Q", "J", "W", "V", "K", "M", "P"]
        self.special_chars = ["_", ".", "-", ""]
    
    def get_length_range(self, selection):
        """Seçilen uzunluk değerine göre min ve max değerleri döndürür"""
        if selection == "4 Karakter":
            return 4, 4
        elif selection == "5 Karakter":
            return 5, 5
        elif selection == "6 Karakter":
            return 6, 6
        elif selection == "7 Karakter":
            return 7, 7
        elif selection == "8 Karakter":
            return 8, 8
        elif selection == "9 Karakter":
            return 9, 9
        elif selection == "10 Karakter":
            return 10, 10
        else:  # "4-10 Karakter"
            return 4, 10
    
    def generate_short_name(self, name_type, length_selection, special_char="_"):
        min_length, max_length = self.get_length_range(length_selection)
        
        # Rastgele uzunluk belirle (min-max arasında)
        length = random.randint(min_length, max_length)
        
        if name_type == "Sadece Harf":
            # Sadece harflerden oluşan kısa isim
            letters = "abcdefghijklmnopqrstuvwxyz"
            return ''.join(random.choice(letters) for _ in range(length))
        
        elif name_type == "Sadece Sayı":
            # Sadece sayılardan oluşan kısa isim
            numbers = "0123456789"
            return ''.join(random.choice(numbers) for _ in range(length))
        
        elif name_type == "Özel Karakterli":
            # Özel karakter içeren isim
            char = special_char
            letters = "abcdefghijklmnopqrstuvwxyz"
            numbers = "0123456789"
            
            if length < 3:
                # Çok kısa isimler için
                parts = [random.choice(letters) for _ in range(length-1)]
                parts.append(char) if char else None
                random.shuffle(parts)
                return ''.join(parts)
            else:
                # Uzun isimler için
                name_length = length - (1 if char else 0)
                name = ''.join(random.choice(letters + numbers) for _ in range(name_length))
                
                if char:
                    # Özel karakteri rastgele bir pozisyona ekle
                    pos = random.randint(0, len(name))
                    return name[:pos] + char + name[pos:]
                return name
        
        else:  # Karma
            # Harf ve sayı karışımı
            chars = "abcdefghijklmnopqrstuvwxyz0123456789"
            return ''.join(random.choice(chars) for _ in range(length))
    
    def check_username_availability(self, username):
        """TikTok kullanıcı adının müsait olup olmadığını kontrol et (simüle edilmiş)"""
        # Kısa isimlerin daha nadir olduğunu varsayalım
        if len(username) <= 5:
            # 5 karakter ve altı isimler %5 ihtimalle müsait
            simulated_availability = random.random() > 0.95
        elif len(username) <= 7:
            # 6-7 karakterli isimler %15 ihtimalle müsait
            simulated_availability = random.random() > 0.85
        else:
            # 8-10 karakterli isimler %30 ihtimalle müsait
            simulated_availability = random.random() > 0.70
        
        return simulated_availability
    
    def generate_names(self, count, name_type, length_selection, special_char):
        results = []
        available_count = 0
        
        for _ in range(count):
            username = self.generate_short_name(name_type, length_selection, special_char)
            is_available = self.check_username_availability(username)
            
            if is_available:
                available_count += 1
                status = "Müsait ✅"
                status_class = "available"
            else:
                status = "Alınmış ❌"
                status_class = "unavailable"
            
            results.append({
                "name": username,
                "length": len(username),
                "status": status,
                "status_class": status_class
            })
        
        return results, available_count

# Flask rotaları
@app.route('/')
def index():
    return render_template('index.html')

@app.route('/generate', methods=['POST'])
def generate_names():
    data = request.json
    count = data.get('count', 12)
    name_type = data.get('name_type', 'Karma')
    length_selection = data.get('length_selection', '4-10 Karakter')
    special_char = data.get('special_char', '_')
    
    generator = PremiumTikTokNameGenerator()
    results, available_count = generator.generate_names(count, name_type, length_selection, special_char)
    
    return jsonify({
        'results': results,
        'available_count': available_count,
        'total_count': count
    })

if __name__ == '__main__':
    app.run(debug=True)
